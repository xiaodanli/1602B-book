require(["jquery","storage","base64","jsonp","getReq","render"],function(n,c,t,i,a,e){var o=n(".mask"),s=n(".set-t"),r=n(".set-b"),l=n(".set-panel"),h=n(".cur");n(".icon-circle-back").on("click",function(){window.location.href="../../page/book-detail.html?fiction_id="+d}),n(".artical-con").on("click",function(){s.show(),r.show(),o.show()}),o.on("click",function(){s.hide(),r.hide(),n(this).hide(),l.hide(),n(".size").removeClass("active")});var d=a().fiction_id,f=c.get("chapter_id")||1;function u(){n.ajax({url:"/api/artical",dataType:"json",data:{fiction_id:d,chapter_id:f},success:function(t){i({url:t.jsonp,callback:"duokan_fiction_chapter",cache:!0,success:function(t){var c=n.base64.atob(t,!0),i=JSON.parse(c);e(i,n("#artical-tpl"),n(".artical-con"),!0)}})},error:function(t){console.warn(t)}})}h.html(f),u(),n(".pre-btn").on("click",function(){1<f?(f-=1,u(),h.html(f),c.set("chapter_id",f)):alert("到头了")}),n(".next-btn").on("click",function(){f<4?(f+=1,u(),h.html(f),c.set("chapter_id",f)):alert("到尾了")}),n.ajax({url:"/api/chapter",dataType:"json",data:{fiction_id:d},success:function(t){n(".total").html(t.item.toc.length)},error:function(t){console.warn(t)}}),n(".chapter-btn").on("click",function(){window.location.href="../../page/chapter-list.html?fiction_id="+d+"&chapter_id="+f}),n(".size").on("click",function(){l.toggle(),n(this).toggleClass("active")});var g=c.get("fz")||14;n(".large-btn").on("click",function(){g<20&&(g+=2,c.set("fz",g)),n("p").css("font-size",g/37.5+"rem")}),n(".small-btn").on("click",function(){10<g&&(g-=2,c.set("fz",g)),n("p").css("font-size",g/37.5+"rem")});var b="#0f1410",k=0!=c.get("mark"),p=c.get("bg")||"#f7eee5";k?n(".artical-con").css("background",b):n(".artical-con").css("background",p),n("#set-bg-btns").on("click","li",function(){n(this).addClass("active").siblings().removeClass("active"),p=n(this).attr("bg-color"),c.set("bg",p),k||n(".artical-con").css("background",p)}),n(".day").on("click",function(){var t=(k=n(this).hasClass("night"))?"白天":"黑夜";n(this).find("dd").text(t),k?n(".artical-con").css("background",b):n(".artical-con").css("background",p),c.set("mark",k),n(this).toggleClass("night")})});