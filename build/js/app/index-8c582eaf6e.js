require(["jquery","swiper","bScroll","render","text!bookTb","text!bookLr","getSlideDirection","storage"],function(n,i,t,l,e,o,a,s){var r,c,d,u=new i(".wrap-swiper"),p=new t(".city-scroll",{probeType:2,click:!0}),m=n(".city-scroll>div"),h=n(".line"),f=n("html").css("fontSize"),g=44*parseFloat(f)/37.5,v=1,w="上拉加载更多",b="下拉刷新",y="释放加载更多",C="释放刷新",T="暂无数据";p.on("scroll",function(){this.y<this.maxScrollY-g?r&&r<v?m.attr("up",T):m.attr("up",y):this.y<this.maxScrollY-g/2?r&&r<v?m.attr("up",T):m.attr("up",w):this.y>g?m.attr("down",C):this.y>g/2&&m.attr("down",b)}),p.on("scrollEnd",function(){r&&r<v?m.attr("up",T):m.attr("up",w),m.attr("down",b)}),p.on("touchEnd",function(){if(m.attr("up")===y){if(r&&r<v)return!1;t=v,n.ajax({url:"/api/recommed",dataType:"json",data:{pageNum:t,count:10},success:function(t){l(t.items,n("#l-r-tpl"),n("#load-more")),p.refresh(),r=t.total/10},error:function(t){console.warn(t)}}),v++}var t;m.attr("down")===C&&location.reload()}),document.addEventListener("touchstart",function(t){c=t.touches[0].pageX,d=t.touches[0].pageY},!1),document.addEventListener("touchend",function(t){var e,o;switch(e=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY,a(c,d,e,o)){case 3:u.slideTo(1),h.addClass("move"),n(".tab-item").eq(1).addClass("active").siblings().removeClass("active");break;case 4:u.slideTo(0),h.removeClass("move"),n(".tab-item").eq(0).addClass("active").siblings().removeClass("active")}},!1),n(".tab-item").on("click",function(){var t=n(this).index();u.slideTo(t),n(this).addClass("active").siblings().removeClass("active"),1==t?h.addClass("move"):h.removeClass("move")}),n(".switch-shelf").on("click",function(){n(".shelf-list").toggleClass("list-type")}),n(".icon-my").on("click",function(){var t;(t=s.get("username")||"")?n.ajax({url:"/isLogin",dataType:"json",type:"post",data:{username:t},success:function(t){console.log(t),1===t.code&&t.result?window.location.href="../../page/my.html":(1===t.code&&!t.result||2===t.code)&&(window.location.href="../../page/login.html")},error:function(t){console.warn(t)}}):location.href="../../page/login.html"}),n("body").append(e),n("body").append(o),n.ajax({url:"/api/index",dataType:"json",success:function(t){console.log(t);var e=t.items[0].data,o=t.items[1].data,a=t.items[2].data.data,s=[a[0]];console.log(s),l(e,n("#slide-tpl"),n(".banner")),l(o,n("#t-b-tpl"),n(".book-t-b-list")),l(s,n("#l-r-tpl"),n("#first-item")),l(a.slice(1),n("#recommend-list-tpl"),n("#not-first-list")),new i(".banner-swiper",{autoplay:3e3,loop:!0,pagination:".swiper-pagination"})},error:function(t){console.warn(t)}})});